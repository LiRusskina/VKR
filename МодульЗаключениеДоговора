   &НаСервере 
Функция ПолучитьСумму(Цена, ТекущаяНоменклатура)
    Запрос = Новый Запрос;
     Запрос.Текст =
	"ВЫБРАТЬ
    |	Цены.Цена КАК Цена
    |ИЗ
    |	РегистрСведений.Цены КАК Цены
    |ГДЕ
    |	Цены.Номенклатура = &Номенклатура";
     Запрос.УстановитьПараметр("Номенклатура", ТекущаяНоменклатура);
    ВыборкаДетальныеЗаписи = Запрос.Выполнить().Выбрать();
    Если ВыборкаДетальныеЗаписи.Следующий() Тогда
     Возврат  ВыборкаДетальныеЗаписи.Цена; 
Иначе
    Возврат 0;
КонецЕсли;      
КонецФункции

&НаКлиенте
Процедура НоменклатураПриИзменении(Элемент)
	Объект.Сумма = ПолучитьСумму(Объект.Сумма, Объект.Номенклатура);
КонецПроцедуры

&НаКлиенте
Процедура ПередЗаписью(Отказ, ПараметрыЗаписи)
	Объект.Оплачено = 0;
	Объект.ОсталосьОплатить = 0;
	Для каждого СтрокаДокумента Из Объект.Оплата Цикл
	Объект.Оплачено = Объект.Оплачено + СтрокаДокумента.Оплачено;
КонецЦикла;  
	Объект.ОсталосьОплатить = Объект.Сумма - Объект.Оплачено;
	Если Объект.ОсталосьОплатить = 0 тогда
		Объект.СтатусОплаты = "Исполнена";
	ИначеЕсли Объект.ОсталосьОплатить <> 0 И НачалоДня(ТекущаяДата()) < Объект.ПлановаяДатаОплаты тогда
		Объект.СтатусОплаты = "Запланирована";
	ИначеЕсли Объект.ОсталосьОплатить <> 0 И НачалоДня(ТекущаяДата()) > Объект.ПлановаяДатаОплаты тогда
		Объект.СтатусОплаты = "Просрочена";
	КонецЕсли;
КонецПроцедуры
